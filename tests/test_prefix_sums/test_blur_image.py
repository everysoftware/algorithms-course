from typing import Any

import pytest

from src.i_prefix_sums.blur_image import box_filter_naive, box_filter_ps


@pytest.mark.parametrize(
    "func",
    [
        box_filter_naive,
        box_filter_ps,
    ],
)
@pytest.mark.parametrize(
    ("m", "image", "expected"),
    [
        (
            1,
            [
                [1, 4, 3, 0, 7],
                [2, 2, 5, 5, 8],
                [3, 1, 5, 6, 6],
                [3, 3, 5, 6, 7],
                [3, 4, 4, 5, 6],
            ],
            [
                [2, 2, 3, 4, 5],
                [2, 2, 3, 5, 5],
                [2, 3, 4, 5, 6],
                [2, 3, 4, 5, 6],
                [3, 3, 4, 5, 6],
            ],
        ),
        (
            2,
            [
                [1, 4, 3, 0, 7],
                [2, 2, 5, 5, 8],
                [3, 1, 5, 6, 6],
                [3, 3, 5, 6, 7],
                [3, 4, 4, 5, 6],
            ],
            [
                [2, 3, 3, 4, 5],
                [3, 3, 4, 4, 5],
                [3, 3, 4, 4, 5],
                [3, 3, 4, 4, 5],
                [3, 4, 4, 4, 5],
            ],
        ),
        (
            3,
            [
                [1, 4, 3, 0, 7],
                [2, 2, 5, 5, 8],
                [3, 1, 5, 6, 6],
                [3, 3, 5, 6, 7],
                [3, 4, 4, 5, 6],
            ],
            [
                [3, 4, 4, 4, 4],
                [3, 4, 4, 4, 4],
                [3, 4, 4, 4, 4],
                [3, 4, 4, 4, 4],
                [3, 4, 4, 4, 4],
            ],
        ),
        (
            1,
            [[1, 1, 1], [1, 7, 1], [1, 1, 1]],
            [[2, 2, 2], [2, 1, 2], [2, 2, 2]],
        ),
        (
            2,
            [[1, 1, 1], [1, 7, 1], [1, 1, 1]],
            [[1, 1, 1], [1, 1, 1], [1, 1, 1]],
        ),
        (
            1,
            [[1, 2, 3], [4, 5, 6], [7, 8, 9]],
            [[3, 3, 4], [4, 5, 5], [6, 6, 7]],
        ),
        (
            2,
            [[1, 2, 3], [4, 5, 6], [7, 8, 9]],
            [[5, 5, 5], [5, 5, 5], [5, 5, 5]],
        ),
    ],
)
def test_box_filter(
    func: Any,
    m: int,
    image: list[list[int]],
    expected: list[list[int]],
) -> None:
    assert func(image, m) == expected
